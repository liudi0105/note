# Java面试题汇总

## Java基础

### 事务

#### 什么是事务

事务是对数据库中一系列操作进行统一的回滚或者提交的操作，主要用来保证数据的完整性和一致性。

#### 事务的传播行为

* 1、PROPAGATION_REQUIRED：如果当前没有事务，就创建一个新事务，如果当前存在事务，就加入该事务，该油墨是最常用的设置
* 2、PROPAGATION_SUPPORTS：支持当前事务，如果当前存在事务，就加入该事务，如果当前不存在事务，就抛出异常。
* 3、PROPAGATION_MANDATORY：支持当前事务，如果当前存在事务，就加入该事务，如果当前不存在事务，就招聘异常。
* 4、PROPAGATION_REQUIRES_NEW：创建新事务，无论当前存不存在事务，都创建新事务。
* 5、PROPAGATION_NEVER：以非事务方式执行，如果当前存在事务，则抛出异常。
* 6、PROPAGATION_NESTED：如果当前存在事务，则在嵌套事务内执行。如果当前没有事务，则执行与 PROPAGATION_REQUIRED 类似。

#### 事务的四个特性

* 1、__原子性__（Atomicity）：同一事务包含的所有操作要么全部成功，要么全部失败（回滚）因此事务的操作如果成功就必须要完全应用到数据库，回滚操作失败则不能对数据库有任何影响。

* 2、__隔离性__（Isolation）：并发执行的事务不会相系影响，其对数据库的影响和它们品德执行时一样。比如多个用户同时往一个账户转账，最后账户的结果应该和他们按先后次序转账的结果一样。

* 3、__一致性__（Consistency）：事务的执行结果必须使数据库从一个一致性状态到另一个一致性状态。其中，一致性状态是指，1、系统的状态满足数据的完整性约束；2、系统的状态反应数据库本应描述的现实世界的真实状态，比如转账前后两个账户的金额总和应该保持不变。

* 4、__持久性__：事务一旦被提交了，那么对数据库中的数据的改变就是永久性的。任何事务或系统故障都不会导致数据丢失。

#### 事务并发时可能遇到的问题

* 1、__脏写__：脏写是指事务回滚了其他事务对数据项的已提交修改。

* 2、__脏读__：脏读是指在一个事务处理过程中读取了另一个未提交的事务中的数据。
* 3、__丢失更新__：丢失更新是指事务覆盖了其他事务对数据的已提交修改，导致这些修改好像丢失了一样。
* 4、__不可重复读__：不可重复读是指同一事务下对同一数据的读取结果前后不一致。
* 5、__幻读__：幻读是指事务读取某个范围的数据时，因为其他事务的操作导致前后内疚读取的结果不一致。

注意：

* **脏读和不可重复读的区别**在于，脏读读取的是事务未提交的脏数据，不可重复读读取的是事务已经提交的数据，只不过因为数据被其他事务修改过导致前后两次读取的结果不一样。

* **幻读和不可重复读的区别**在于，不可重复读是针对确定的某一行数据而言，而幻读是针对不确定的多行数据。因而幻读通常出现在带有查询条件的范围查询中。不可重复读侧重于修改，幻读侧重于新增或删除。解决不可重复读的问题只需锁住满足条件的行，解决幻读需要锁表。

#### 事务的隔离级别

* 1、__读未提交__（Read uncommitted）：一个事务可以读取另一个尚未提交事务的数据，该级别下，写数据时会锁住相应的行。

* 2、__读已提交__（Read committed）：一个事务要等另一个事务提交后才能读取数据。
* 3、__可重复读__（Repeatable read）：在开始读取数据（事务开启）时，不再允许修改操作，该级别下，写数据会锁住整张表。
* 4、__串行化__（Serializable）：这是最高的隔离级别，它通过强制事务排序，使之不可能相互冲突，从而解决幻续问题。在这个级别，可能导致大量的超时现象和锁竞争。该级别下，读写数据都会锁住整张表。

|事务的隔离级别|脏写|脏读|不可重复读|幻读|丢失更新|
|-|-|-|-|-|-|
|读未提交||✔|✔|✔|✔|
|读已提交|||✔|✔|✔|
|可重复读||||✔||
|串行化||||||

所有事务隔离级别都不允许出现脏写，而串行化可以避免所有可能出现的并发异常，但是会极大的降低系统的并发处理能力。

#### 什么是嵌套事务

嵌套是子事务套在父事务中执行，子事务是父事务的一部分，在进入子事务之前，父事务建立一个回滚点（save point），然后执行子事务，这个子事务的执行也算是父事务的一部分，然后子事务报告结束，父事务继续执行。

#### 如果子事务回滚，会发生什么

父事务会回滚到进入子事务前建立的 回滚点，然后尝试其他的事务或者其他的业务逻辑，父事务之前的操作不会受到影响，更不会自动回滚。

#### 如果父事务回滚，会发生什么

父事务回滚，子事务也会跟着回滚！为什么呢，因为父事务结束之前，子事务是不会提交的，我们说子事务是父事务的一部分，正是这个道理。

#### 事务的提交是什么情况

是父事务先提交，然后子事务提交，还是子事务先提交，父事务再提交？答案是第二和情况，还是那句话，子事务是父事务的一部分，由父事务统一提交。
